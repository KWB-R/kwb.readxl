<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read Raw Text Information from Excel Files • kwb.readxl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Read Raw Text Information from Excel Files">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kwb.readxl</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">Read Raw Text Information from Excel Files</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/KWB-R/kwb.readxl">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Read Raw Text Information from Excel Files</h1>
                        <h4 class="author">Hauke Sonnenberg</h4>
            
            <h4 class="date">2019-03-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/kwb.readxl/blob/master/vignettes/tutorial.Rmd"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<p>This package provides functions to read data from Microsoft Excel files. It uses the package <a href="https://readxl.tidyverse.org/">readxl</a> under the hood. In contrast to the default behaviour of readxl the functions in this package read the raw text information that are contained in the sheets. No type conversions are performed and all values keep their original position. For example, a value in cell A3 is returned in <code>sheet[3, 1]</code> with <code>sheet</code> being the result matrix returned when reading one Excel sheet. By default, <code><a href="https://readxl.tidyverse.org/reference/read_excel.html">readxl::read_excel()</a></code> returns this value in the first row of the returned data frame, given that the first two rows are empty. This may be useful in some cases but for validation purposes I prefer to keep the original positions.</p>
<div id="reading-table-data-from-a-spreadsheet-program" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-table-data-from-a-spreadsheet-program" class="anchor"></a>Reading Table Data from a Spreadsheet Program</h2>
<p>MS Excel is a spreadsheet program. It does not really know where a table starts and where it ends and it does not clearly assign a type to a column. Instead, each cell can have its own type so that there can be cells of different types in one and the same column. However, functions such as <code><a href="https://readxl.tidyverse.org/reference/read_excel.html">readxl::read_excel()</a></code> try to communicate with Excel as if it was a database management system. For each column the values in the first few rows of the column are inspected and the type of the column is guessed. Then, all values in the column are tried to be converted to the guessed type. This leads to conversion errors, e.g. if the first few values look numeric but the column contains text values, such as <code>"&lt;1000"</code> further down. In the returned data frame the text values are removed, i.e. set to <code>NA</code>. This package avoids these data losses as it keeps the original (text) information and lets the user decide what to do.</p>
</div>
<div id="read-sheet-with-readxl" class="section level2">
<h2 class="hasAnchor">
<a href="#read-sheet-with-readxl" class="anchor"></a>Read sheet with readxl</h2>
<p>Let’s check this behaviour out by reading a sheet from an example Excel file. The top and bottom parts of the “table” contained in the sheet look as follows:</p>
<p><a href=""><img src="images/example_2_top.png" alt="table top"></a> <a href=""><img src="images/example_2_bottom.png" alt="table top"></a></p>
<p>We start by reading this sheet with the <code>read_excel()</code> function from the readxl package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Path to example Excel file</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/example_2.xlsx"</span>, <span class="dt">package =</span> <span class="st">"kwb.readxl"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># Read the first sheet with readxl::read_excel</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">data &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span>(file)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; Warning in read_fun(path = enc2native(normalizePath(path)), sheet_i =</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; sheet, : Expecting numeric in B1004 / R1004C2: got '&gt;1000'</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># The first empty rows were skipped and both columns are numeric (double)</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt;     Row Value</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; 1     4     1</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; 2     5     2</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; 3     6     3</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; 4     7     4</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; 5     8     5</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; 6     9     6</span></a></code></pre></div>
<p>As described above, the two empty rows on top were skipped and the second column was assumed to be of numeric type even though it contains a text value in row 1004 (see image above).</p>
</div>
<div id="read-sheet-with-kwb-readxl" class="section level2">
<h2 class="hasAnchor">
<a href="#read-sheet-with-kwb-readxl" class="anchor"></a>Read sheet with kwb.readxl</h2>
<p>Now let’s read the same sheet with <code><a href="../reference/get_raw_text_from_xlsx.html">get_raw_text_from_xlsx()</a></code> from this package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Read the sheet into a list of character matrices</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">sheets &lt;-<span class="st"> </span>kwb.readxl<span class="op">::</span><span class="kw">get_raw_text_from_xlsx</span>(file, <span class="dt">sheets =</span> <span class="st">"two_empty_rows"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;   File: 'example_2.xlsx'</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; Folder: '/home/travis/R/Library/kwb.readxl/extdata'</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; Reading sheet 'two_empty_rows' as raw text ...</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; New names:</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; * `` -&gt; `..1`</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; * `` -&gt; `..2`</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; ok.</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co"># Show the first rows of the first matrix</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sheets<span class="op">$</span>sheet_<span class="dv">01</span>)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt;      col_01 col_02 </span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; [1,] NA     NA     </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; [2,] NA     NA     </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; [3,] "Row"  "Value"</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; [4,] "4"    "1"    </span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; [5,] "5"    "2"    </span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; [6,] "6"    "3"</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co"># Show the last rows of the first matrix</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(sheets<span class="op">$</span>sheet_<span class="dv">01</span>)</a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt;         col_01 col_02 </span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt;  [999,] "999"  "996"  </span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; [1000,] "1000" "997"  </span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt; [1001,] "1001" "998"  </span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#&gt; [1002,] "1002" "999"  </span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt; [1003,] "1003" "1000" </span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#&gt; [1004,] "1004" "&gt;1000"</span></a></code></pre></div>
<p>The first two empty rows are kept so that the row number in the returned matrix corresponds to the row number in the Excel file. This is helpful if we want to warn the user about possible problems, such as the non-numeric value in row 1004:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Store the text matrix in sheet</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">sheet &lt;-<span class="st"> </span>sheets<span class="op">$</span>sheet_<span class="dv">01</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># Get the number of the row containing a non-numeric value in column 2 </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">invalid_row &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(sheet[, <span class="dv">2</span>]))))</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; Warning in which(is.na(as.numeric(sheet[, 2]))): NAs introduced by coercion</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># Give a message to the user</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"Dear user, please have a look at row"</span>, invalid_row, <span class="st">"of the sheet"</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; Dear user, please have a look at row 1004 of the sheet</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#reading-table-data-from-a-spreadsheet-program">Reading Table Data from a Spreadsheet Program</a></li>
      <li><a href="#read-sheet-with-readxl">Read sheet with readxl</a></li>
      <li><a href="#read-sheet-with-kwb-readxl">Read sheet with kwb.readxl</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/hsonne">Hauke Sonnenberg</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f7867aca9b0ca9582980427e7ed17d2e',
    indexName: 'kwb_readxl',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
